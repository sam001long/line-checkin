<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="color-scheme" content="light dark">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>闖關遊戲</title>
  <style>
    :root { --bg: #0b0c0f; --fg:#f5f7fb; --muted:#a4adbc; --card:#141821; }
    html,body{margin:0; padding:0; background:var(--bg); color:var(--fg); font: 16px/1.5 system-ui, -apple-system, "Noto Sans TC", Arial, "Segoe UI", sans-serif;}
    .wrap {max-width: 960px; margin: 0 auto; padding: clamp(16px, 4vw, 28px);}    
    header {display:flex; align-items:center; justify-content:space-between; gap: 16px; margin-bottom: 16px;}
    h1 {font-size: clamp(20px, 3.5vw, 28px); margin: 0;}
    p.tip {margin:0; font-size: 14px; color: var(--muted);}    

    .grid{display:grid; grid-template-columns: repeat(2, 1fr); gap:12px;}
    @media (min-width: 540px){ .grid{ grid-template-columns: repeat(3, 1fr);} }

    .card{ position: relative; border-radius: 16px; overflow: hidden; background: var(--card); box-shadow: 0 6px 14px rgba(0,0,0,.35);}    
    .card img{ width: 100%; height: 100%; display:block; aspect-ratio: 1/1; object-fit: cover; }
    .card a{ position:absolute; inset:0; border:none;}
    .sr-only {position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0;}

    /* lightbox */
    .lightbox{ position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,.8); z-index: 9999; }
    .lightbox.open{ display: flex; }
    .lightbox figure{ margin:0; max-width: 100vw; max-height: 100vh; padding: clamp(8px, 2vw, 16px); }
    .lightbox img{ max-width: 100%; max-height: calc(100vh - 90px); display:block; border-radius: 12px; }
    .actions{ display:flex; gap:8px; justify-content: center; margin-top: 8px;}
    .btn{ appearance:none; border: 1px solid rgba(255,255,255,.2); background: rgba(255,255,255,.06); color: var(--fg); padding: 10px 14px; border-radius: 999px; font-size: 14px; cursor: pointer; }
    .btn:active{ transform: translateY(1px); }
    .btn.link{ text-decoration: none; display:inline-flex; align-items:center; }
    .close{ position: absolute; top: env(safe-area-inset-top, 12px); right: 12px; background: rgba(0,0,0,.5); border: 1px solid rgba(255,255,255,.2); width:40px; height:40px; border-radius: 999px; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700; cursor:pointer; }
    .spinner{ width:28px; height:28px; border:3px solid rgba(255,255,255,.25); border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite; margin: 10vh auto; display:none;}
    .spinner.show{ display:block;}
    @keyframes spin{ to{ transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>闖關遊戲</h1>
      <p class="tip">點縮圖可檢視大圖</p>
    </header>

    <main class="grid" id="grid">
      <!-- Cards injected by JS -->
    </main>
  </div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="大圖檢視">
    <button class="close" id="closeBtn" aria-label="關閉">✕</button>
    <figure>
      <img id="fullImg" alt="">
      <div class="actions">
        <a id="openOriginal" class="btn link" href="#" target="_blank" rel="noopener">另開原圖</a>
        <button id="downloadBtn" class="btn">儲存到相簿</button>
      </div>
    </figure>
  </div>

  <div class="spinner" id="spinner"></div>

  <script>
    // === 設定：把你的圖片檔名放這裡（6 張） ===
    // 建議把縮圖放 /images/thumbs/ ，大圖放 /images/full/
    const IMAGES = [
      {thumb: 'images/thumbs/1.jpg', full: 'images/full/1.jpg', alt: '圖 1'},
      {thumb: 'images/thumbs/2.jpg', full: 'images/full/2.jpg', alt: '圖 2'},
      {thumb: 'images/thumbs/3.jpg', full: 'images/full/3.jpg', alt: '圖 3'},
      {thumb: 'images/thumbs/4.jpg', full: 'images/full/4.jpg', alt: '圖 4'},
      {thumb: 'images/thumbs/5.jpg', full: 'images/full/5.jpg', alt: '圖 5'},
      {thumb: 'images/thumbs/6.jpg', full: 'images/full/6.jpg', alt: '圖 6'},
    ];

    // === 產生 6 張卡片 ===
    const grid = document.getElementById('grid');
    for (const [i, img] of IMAGES.entries()) {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${img.thumb}" loading="lazy" decoding="async" alt="${img.alt}">
        <a href="${img.full}" aria-label="開啟 ${img.alt}" data-index="${i}"><span class="sr-only">開啟 ${img.alt}</span></a>
      `;
      grid.appendChild(card);
    }

    // === Lightbox ===
    const lightbox = document.getElementById('lightbox');
    const fullImg = document.getElementById('fullImg');
    const openOriginal = document.getElementById('openOriginal');
    const closeBtn = document.getElementById('closeBtn');
    const spinner = document.getElementById('spinner');
    const downloadBtn = document.getElementById('downloadBtn');
    let currentIndex = 0;

    grid.addEventListener('click', e => {
      const link = e.target.closest('a');
      if (!link) return;
      e.preventDefault();
      const idx = Number(link.dataset.index || 0);
      openLightbox(idx);
    });

    function openLightbox(idx) {
      currentIndex = idx;
      const { full, alt } = IMAGES[idx];
      spinner.classList.add('show');
      lightbox.classList.add('open');
      fullImg.src = ''; // reset
      fullImg.alt = alt;
      const img = new Image();
      img.onload = () => {
        fullImg.src = full;
        spinner.classList.remove('show');
      };
      img.onerror = () => {
        spinner.classList.remove('show');
        alert('大圖載入失敗');
      };
      img.src = full;
      openOriginal.href = full;
      // Focus for accessibility
      closeBtn.focus({preventScroll:true});
      history.pushState({lightbox:true}, '');
    }

    function closeLightbox() {
      lightbox.classList.remove('open');
      fullImg.src = '';
      // 將狀態回退，避免 LINE 內建返回鍵直接離開頁面
      if (history.state && history.state.lightbox) {
        history.back();
      }
    }

    closeBtn.addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', e => {
      if (e.target === lightbox) closeLightbox();
    });
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') closeLightbox();
      if (e.key === 'ArrowRight') navigate(1);
      if (e.key === 'ArrowLeft') navigate(-1);
    });

    function navigate(dir) {
      if (!lightbox.classList.contains('open')) return;
      currentIndex = (currentIndex + dir + IMAGES.length) % IMAGES.length;
      openLightbox(currentIndex);
    }

    // 下載：在某些內建瀏覽器（包含 LINE）可能不支援，自動退回另開原圖
    downloadBtn.addEventListener('click', () => {
      try {
        const a = document.createElement('a');
        a.href = IMAGES[currentIndex].full;
        a.download = IMAGES[currentIndex].full.split('/').pop();
        document.body.appendChild(a);
        a.click();
        a.remove();
      } catch (err) {
        openOriginal.click();
      }
    });

    // 防止雙擊縮放影響點擊體驗
    let lastTouch = 0;
    document.addEventListener('touchend', e => {
      const now = Date.now();
      if (now - lastTouch <= 300) e.preventDefault();
      lastTouch = now;
    }, {passive:false});
  </script>
</body>
</html>
